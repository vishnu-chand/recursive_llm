import json

x = r"""

{"thought": "The user is asking about 'hair loss issues'. I will first define a comprehensive list of keywords and related terms that might appear in the medical context, including specific conditions, symptoms, and potential causes/treatments for hair loss. Then, I will process the CONTEXT in manageable chunks. For each chunk, I'll first pre-filter using the expanded keywords to narrow down relevant sections. Finally, I will use `llm_query` on these relevant chunks to extract specific details pertaining to hair loss issues.", "code": "import re\n\ndef get_chunks(text, chunk_size=2000, overlap=100):\n    words = text.split()\n    chunks = []\n    for i in range(0, len(words), chunk_size - overlap):\n        chunks.append(\" \".join(words[i : i + chunk_size]))\n    return chunks\n\n# 1. Semantic Expansion: Broaden the search terms for 'hair loss issues'\nkeywords = [\n    \"hair loss\", \"alopecia\", \"balding\", \"thinning hair\", \"effluvium\",\n    \"telogen effluvium\", \"anagen effluvium\", \"androgenetic alopecia\",\n    \"traction alopecia\", \"alopecia areata\", \"trichotillomania\",\n    \"dermatitis\", \"scalp conditions\", \"thyroid\", \"iron deficiency\",\n    \"vitamin deficiency\", \"medication side effect\", \"chemotherapy\",\n    \"stress\", \"hormonal imbalance\", \"dermatology\", \"biotin\",\n    \"minoxidil\", \"finasteride\", \"prp\", \"platelet rich plasma\"\n]\n\ntext_chunks = get_chunks(CONTEXT)\nrelevant_findings = []\n\nfor i, snippet in enumerate(text_chunks):\n    # Pre-filter: Check if any of the keywords are present in the snippet\n    if any(re.search(r'\\b' + re.escape(term) + r'\\b', snippet, re.IGNORECASE) for term in keywords):\n        # 3. EXTRACT via Sub-Agent: Ask the LLM to find specific details\n        # The query is designed to extract any mention of hair loss issues, their causes, or treatments.\n        extracted_note = llm_query(\n            f\"Extract any information regarding hair loss issues, including specific conditions, symptoms, causes, or treatments mentioned in this text.\",\n            snippet\n        )\n        if extracted_note:\n            relevant_findings.append(f\"Chunk {i+1}: {extracted_note}\")\n\n# 4. Synthesize the findings\nif relevant_findings:\n    # If multiple findings, ask the LLM to consolidate into a clear summary\n    FINAL(llm_query(\n        \"Summarize all identified hair loss issues, including any mentioned causes, diagnoses, or treatments from the following information:\",\n        \"\\n\".join(relevant_findings)\n    ))\nelse:\n    FINAL(\"No specific hair loss issues were found in the patient's history.\")"}
""".strip()

x = json.loads(x)
